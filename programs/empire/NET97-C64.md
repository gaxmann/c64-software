# NET97-C64 NETWORK SOFTWARE

## NET97 C64 Userport Network (historical reconstruction notes)

This document summarises the reconstructed hardware and software behaviour for a max. 4-node C64 userport network used by “Empire C64”. The original documentation is lost. This document has been reconstructed from memory.  

## Hardware overview

The network is a 4-wire shared bus:

1) GND
2) CNT2  (CIA2 serial clock)  -> userport pin 6
3) SP2   (CIA2 serial data)   -> userport pin 7
4) PB7   (CIA2 port B bit 7)  -> userport pin L (BUSY line, active-low)

Node IDs are configured locally on each plug via two input bits:

- PB0 (userport pin C) = ID bit 0
- PB1 (userport pin D) = ID bit 1

Two bits allow 4 IDs (ID#1..ID#4). The plug labels match the software’s internal numbering.

Physical order on the cable (it is important!! that ID#2 is at the end of the cable):
- ID#1, ID#4, ID#3, ID#2

Cable length was approximately 3 metres. The cable was physically daisy-chained (two or four plugs on one cable) but electrically a single bus (each signal conductor continuous across all plugs). When you use only two plugs we tested cable length up to 20m with no problems, but when you have open unused plugs in the middle of the cable, you better only use 3m of cable.

## PB7 BUSY / arbitration behaviour

From the client and master binaries (“transm 2.75” and “sd2.75”), PB7 is used with this polarity:

- PB7 HIGH = bus free / released
- PB7 LOW  = bus busy / claimed

Typical sequence observed in both programs:
- Wait until PB7 reads HIGH
- Switch PB6/PB7 direction to output (DDRB = $C0)
- Force PB6/PB7 low (mask PRB with $3F and write back)
- Perform serial transfer steps
- Release bus again by switching DDRB back to input (DDRB = $00)

This is consistent with an open-bus style arbitration line:
participants only drive PB7 low when claiming the bus.

## Bias / termination (as remembered)

- PB7 had a pull-up to +5 V at ID#1 (master end), typically 4.7 kΩ.
- ID#1 also had an activity LED that indicates bus usage (LED on when PB7 is pulled low).
- SP2 and CNT2 were left without explicit external pull-ups (bus relied on device behaviour / internal characteristics).

Note: When reproducing, it might be prudent to provide optional pull-ups for SP2/CNT2 (e.g. 10 kΩ to +5 V at one end) as a stability option.

## ID strapping (PB0/PB1): physical wiring vs software numbering

There are two separate concepts:

1) Physical strap wiring (what you solder):
- Strap PB0 and PB1 via resistors either to GND or to +5 V (local +5 V on that machine).
- Recommended safe resistor value: 4.7 kΩ.

2) Software numbering / plug labels:
- The software reads PB0/PB1 and maps the 2-bit value to the internal node numbering. The plugs were labelled ID#1..ID#4 and this mapping matches the software.

Mapping to plug labels (ID#1..ID#4):

- ID#1: PB1 -> GND, PB0 -> GND
- ID#2: PB1 -> GND, PB0 -> +5 V
- ID#3: PB1 -> +5 V, PB0 -> GND
- ID#4: PB1 -> +5 V, PB0 -> +5 V

## Software components

Bootstrap:
- “transm 2.75” is the receiver/client program for nodes ID#2..ID#4.
- “sd2.75” is the host/distributor program for node ID#1.

Both programs use CIA2 registers ($DDxx), including:
- $DD01 (PRB) for PB7 busy and PB0/PB1 ID read
- $DD03 (DDRB) to switch PB6/PB7 between input and output
- $DD0C (SDR) for serial byte transfer
- $DD04/$DD05 (Timer A) and $DD0E (CRA) to drive timing / serial mode
- $DD0D (ICR) to poll/ack serial shift completion

## Boot / distribution sequence (operational description)

1) Clients (ID#2..ID#4) start in receive mode (software: “transm 2.75”), allowing the initial host (ID#1) to detect present nodes via a handshake/ACK scheme.
2) ID#1 distributes the required software payload over the network:
   - map data
   - character set
   - machine code routines
   - BASIC program variant (human vs computer player)
   - SD2.75 itself
3) After distribution, clients stop TRANSM 2.75 and start:
   - SD2.75 on all nodes
   - plus the distributed BASIC program
4) During play, each node has all required local data; only deltas/updates are exchanged.
   Updates may be broadcast to all nodes or sent to a single affected node.

## Open items / unknowns

- Whether additional pull-ups on SP2/CNT2 were present in the original plugs (not required by the binaries alone).



